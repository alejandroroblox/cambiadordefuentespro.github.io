<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creador de Extensiones de Fuente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { transition: font-family 0.3s ease; }
        .drop-zone { border: 2px dashed #cbd5e1; transition: all 0.3s ease; }
        .drop-zone.active { border-color: #3b82f6; background-color: #eff6ff; }
        .font-ready { border-color: #10b981; background-color: #ecfdf5; }
        
        pre {
            background-color: #0f172a;
            color: #94a3b8;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <div class="max-w-4xl mx-auto p-6 lg:p-12">
        <header class="mb-10 text-center">
            <h1 class="text-4xl font-extrabold tracking-tight mb-2 text-slate-800">Generador de Extensión de Fuente</h1>
            <p class="text-slate-600">Convierte tu archivo .ttf en una extensión que cambia la fuente de todas las webs automáticamente.</p>
        </header>

        <main class="grid gap-8">
            <!-- Paso 1: Carga -->
            <section class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <span class="bg-blue-600 text-white w-6 h-6 rounded-full inline-flex items-center justify-center text-xs mr-2">1</span>
                    Selecciona tu fuente (.ttf)
                </h2>
                <div id="dropZone" class="drop-zone rounded-xl p-10 text-center cursor-pointer mb-6">
                    <div class="flex flex-col items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-slate-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-lg font-medium text-slate-700" id="dropZoneText">Arrastra tu archivo aquí</p>
                    </div>
                    <input type="file" id="fontInput" accept=".ttf" class="hidden">
                </div>
                
                <div id="fileInfo" class="hidden text-center mb-6">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800">
                        Fuente cargada: <span id="fileName" class="ml-1 font-bold">--</span>
                    </span>
                </div>

                <button id="generateBtn" disabled class="w-full py-4 bg-slate-300 text-slate-500 cursor-not-allowed rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2">
                    Generar Archivos de Extensión
                </button>
            </section>

            <!-- Paso 2: Instrucciones de Instalación (Se activa al generar) -->
            <section id="instructionsPanel" class="hidden bg-white p-8 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 flex items-center text-emerald-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Extensión Lista - Cómo instalarla:
                </h2>
                
                <div class="space-y-6">
                    <div class="bg-slate-50 p-4 rounded-lg border-l-4 border-blue-500 text-sm">
                        <ol class="list-decimal ml-5 space-y-2">
                            <li>Crea una carpeta en tu ordenador (ej: <code class="font-mono bg-white px-1">mi-fuente-ext</code>).</li>
                            <li>Mete tu archivo <strong class="font-bold current-font-name">fuente.ttf</strong> en esa carpeta.</li>
                            <li>Crea un archivo llamado <code class="font-mono bg-white px-1 font-bold">manifest.json</code> y pega el código de abajo.</li>
                            <li>Crea un archivo llamado <code class="font-mono bg-white px-1 font-bold">content.js</code> y pega el otro código.</li>
                            <li>En Chrome/Edge, ve a <code class="text-blue-600 font-mono">chrome://extensions</code>.</li>
                            <li>Activa el <strong>"Modo de desarrollador"</strong> (arriba a la derecha).</li>
                            <li>Pulsa en <strong>"Cargar descomprimida"</strong> y elige tu carpeta.</li>
                        </ol>
                    </div>

                    <div>
                        <h3 class="font-bold text-slate-700 text-sm mb-2">1. Código para manifest.json</h3>
                        <pre id="manifestCode"></pre>
                    </div>

                    <div>
                        <h3 class="font-bold text-slate-700 text-sm mb-2">2. Código para content.js</h3>
                        <pre id="contentJsCode"></pre>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        const fontInput = document.getElementById('fontInput');
        const dropZone = document.getElementById('dropZone');
        const generateBtn = document.getElementById('generateBtn');
        const instructionsPanel = document.getElementById('instructionsPanel');
        const fileNameDisp = document.getElementById('fileName');
        const manifestCodeDisp = document.getElementById('manifestCode');
        const contentJsCodeDisp = document.getElementById('contentJsCode');

        let selectedFileName = '';

        dropZone.addEventListener('click', () => fontInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('active'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('active'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('active');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });

        fontInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.ttf')) {
                alert('Solo se permiten archivos .ttf');
                return;
            }
            selectedFileName = file.name;
            fileNameDisp.textContent = selectedFileName;
            document.querySelectorAll('.current-font-name').forEach(el => el.textContent = selectedFileName);
            
            document.getElementById('fileInfo').classList.remove('hidden');
            dropZone.classList.add('font-ready');
            
            generateBtn.disabled = false;
            generateBtn.classList.remove('bg-slate-300', 'text-slate-500');
            generateBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
        }

        generateBtn.addEventListener('click', () => {
            // Generar Manifest V3
            const manifest = {
                "manifest_version": 3,
                "name": "Extension de Fuente Personalizada",
                "version": "1.0",
                "description": "Cambia la fuente de todas las webs automáticamente.",
                "content_scripts": [
                    {
                        "matches": ["<all_urls>"],
                        "js": ["content.js"],
                        "run_at": "document_start"
                    }
                ],
                "web_accessible_resources": [
                    {
                        "resources": [selectedFileName],
                        "matches": ["<all_urls>"]
                    }
                ]
            };

            // Generar Content JS que inyecta el CSS dinámicamente
            const contentJs = `
(function() {
    const fontName = 'CustomBrowserFont';
    const fontUrl = chrome.runtime.getURL('${selectedFileName}');

    const style = document.createElement('style');
    style.textContent = \`
        @font-face {
            font-family: '\${fontName}';
            src: url('\${fontUrl}') format('truetype');
        }
        * {
            font-family: '\${fontName}', sans-serif !important;
        }
    \`;
    
    // Inyectar lo más pronto posible
    document.documentElement.appendChild(style);
})();`;

            manifestCodeDisp.textContent = JSON.stringify(manifest, null, 4);
            contentJsCodeDisp.textContent = contentJs;
            instructionsPanel.classList.remove('hidden');
            
            // Scroll suave a las instrucciones
            instructionsPanel.scrollIntoView({ behavior: 'smooth' });
        });
    </script>
</body>
</html>
