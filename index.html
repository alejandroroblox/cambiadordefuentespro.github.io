<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instalador de Extensión de Fuente Adaptativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .step-number {
            @apply flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white font-bold mr-3;
        }
        .browser-badge {
            @apply px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen font-sans">

    <div class="max-w-3xl mx-auto p-8 lg:p-12">
        <header class="text-center mb-12">
            <div id="browserDetector" class="mb-4 flex justify-center">
                <!-- Se llenará con JS -->
            </div>
            <h1 class="text-4xl font-extrabold text-slate-800 mb-2">Instalador de Extensión</h1>
            <p id="browserGreeting" class="text-lg text-slate-600 italic">Detectando tu navegador...</p>
        </header>

        <div class="space-y-8">
            <!-- PASO 1 -->
            <section class="bg-white p-6 rounded-2xl shadow-md border border-slate-200">
                <div class="flex items-center mb-6">
                    <span class="step-number">1</span>
                    <h2 class="text-xl font-bold">Descarga los Archivos</h2>
                </div>
                <p class="text-slate-600 mb-6">Crea una carpeta en tu equipo y descarga estos 3 archivos necesarios para la extensión:</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="downloadFile('manifest.json', getManifest())" class="flex items-center justify-center gap-2 bg-slate-800 text-white p-3 rounded-xl hover:bg-slate-700 transition shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        manifest.json
                    </button>
                    <button onclick="downloadFile('content.js', getContentJs())" class="flex items-center justify-center gap-2 bg-slate-800 text-white p-3 rounded-xl hover:bg-slate-700 transition shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        content.js
                    </button>
                    <button onclick="downloadFile('popup.html', getPopupHtml())" class="flex items-center justify-center gap-2 bg-slate-800 text-white p-3 rounded-xl hover:bg-slate-700 transition shadow-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        popup.html
                    </button>
                </div>
            </section>

            <!-- PASO 2 -->
            <section class="bg-white p-6 rounded-2xl shadow-md border border-slate-200">
                <div class="flex items-center mb-6">
                    <span class="step-number">2</span>
                    <h2 class="text-xl font-bold">Configuración en <span class="browser-name">el Navegador</span></h2>
                </div>
                <p class="text-slate-600 mb-4">Copia y pega la siguiente dirección en una nueva pestaña para ir al panel de extensiones:</p>
                <div class="bg-blue-50 p-4 rounded-xl text-blue-800 border border-blue-100 flex items-center justify-between group">
                    <strong id="browserUrl" class="font-mono text-lg select-all text-blue-900">chrome://extensions</strong>
                    <span class="text-xs text-blue-400 font-semibold group-hover:text-blue-600 cursor-pointer">URL DE CONTROL</span>
                </div>
                <p class="mt-4 text-slate-600">
                    Una vez allí, busca el interruptor <strong>"Modo de desarrollador"</strong> (o "Developer mode") y <strong>actívalo</strong>.
                </p>
            </section>

            <!-- PASO 3 -->
            <section class="bg-white p-6 rounded-2xl shadow-md border border-slate-200">
                <div class="flex items-center mb-6">
                    <span class="step-number">3</span>
                    <h2 class="text-xl font-bold">Instalación Final</h2>
                </div>
                <p class="text-slate-600 mb-4">Haz clic en el botón <strong>"Cargar descomprimida"</strong> (o "Load unpacked") y selecciona la carpeta donde guardaste los archivos.</p>
                <div class="p-4 bg-emerald-50 text-emerald-800 rounded-xl border border-emerald-100 flex items-start gap-3">
                    <svg class="w-6 h-6 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <div>
                        <p class="font-bold mb-1">¡Listo!</p>
                        <p class="text-sm">Busca el icono de la extensión en tu barra de herramientas, ábrelo y selecciona tu archivo <strong>.ttf</strong> para cambiar la fuente en todo el navegador.</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Detección de Navegador
        window.onload = function() {
            const userAgent = navigator.userAgent;
            let browser = "Chrome";
            let url = "chrome://extensions";
            let color = "bg-blue-100 text-blue-800";

            if (userAgent.match(/edg/i)) {
                browser = "Microsoft Edge";
                url = "edge://extensions";
                color = "bg-sky-100 text-sky-800";
            } else if (userAgent.match(/brave/i) || (navigator.brave && navigator.brave.isBrave())) {
                browser = "Brave";
                url = "brave://extensions";
                color = "bg-orange-100 text-orange-800";
            } else if (userAgent.match(/OPX/i)) { // Detección específica de Opera GX
                browser = "Opera GX";
                url = "opera://extensions";
                color = "bg-red-600 text-white"; // Color distintivo GX
            } else if (userAgent.match(/opr|opera/i)) {
                browser = "Opera";
                url = "opera://extensions";
                color = "bg-red-100 text-red-800";
            }

            // Actualizar Interfaz
            document.getElementById('browserDetector').innerHTML = `<span class="browser-badge ${color}">${browser} Detectado</span>`;
            document.getElementById('browserGreeting').textContent = `Instrucciones personalizadas para ${browser}`;
            document.getElementById('browserUrl').textContent = url;
            document.querySelectorAll('.browser-name').forEach(el => el.textContent = browser);
        };

        function downloadFile(name, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function getManifest() {
            return JSON.stringify({
                "manifest_version": 3,
                "name": "Fuente Personalizada Dinámica",
                "version": "1.1",
                "permissions": ["storage"],
                "action": { "default_popup": "popup.html" },
                "content_scripts": [{
                    "matches": ["<all_urls>"],
                    "js": ["content.js"],
                    "run_at": "document_start"
                }]
            }, null, 4);
        }

        function getContentJs() {
            return `(function() {
    chrome.storage.local.get("customFont", (data) => {
        if (data.customFont) {
            const fontName = 'UserCustomFont';
            const style = document.createElement('style');
            style.textContent = \`
                @font-face {
                    font-family: '\${fontName}';
                    src: url('\${data.customFont}') format('truetype');
                }
                * {
                    font-family: '\${fontName}', sans-serif !important;
                }
            \`;
            document.documentElement.appendChild(style);
        }
    });
})();`;
        }

        function getPopupHtml() {
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { width: 250px; padding: 15px; font-family: sans-serif; background: #f8fafc; color: #1e293b; }
        h3 { margin-top: 0; color: #0f172a; font-size: 16px; }
        .btn { background: #2563eb; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: bold; font-size: 14px; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .footer { font-size: 10px; color: #64748b; margin-top: 12px; text-align: center; }
    </style>
</head>
<body>
    <h3>Configurar Fuente</h3>
    <input type="file" id="fontInput" accept=".ttf">
    <button id="saveBtn" class="btn">Guardar y Aplicar</button>
    <div class="footer">Recarga la web tras guardar</div>
    <script>
        document.getElementById('saveBtn').addEventListener('click', () => {
            const file = document.getElementById('fontInput').files[0];
            if (!file) { alert("Selecciona un archivo .ttf primero"); return; }
            const reader = new FileReader();
            reader.onload = (e) => {
                chrome.storage.local.set({ "customFont": e.target.result }, () => {
                    alert("¡Fuente guardada! Por favor, recarga las pestañas abiertas.");
                });
            };
            reader.readAsDataURL(file);
        });
    <\/script>
</body>
</html>`;
        }
    </script>
</body>
</html>
